import"./modulepreload-polyfill-B5Qt9EMX.js";const Ge={frames:[{id:"light",name:"LIGHT",hp:70,speed:240,en:100,enRegen:18,desc:"高速。薄い。回避で生きる。"},{id:"middle",name:"MIDDLE",hp:95,speed:210,en:120,enRegen:14,desc:"標準。バランス。"},{id:"heavy",name:"HEAVY",hp:130,speed:175,en:140,enRegen:11,desc:"鈍い。硬い。詰みづらい。"}],weapons:[{id:"mg",name:"Machinegun",type:"bullet",range:900,dps:14,cd:.1,speed:1e3,desc:"連射。見てて気持ちいい。",pierce:!1,explodeOnObstacle:!1},{id:"cannon",name:"Cannon",type:"bullet",range:1250,dps:22,cd:.55,speed:1250,desc:"高威力。遠距離。",pierce:!1,explodeOnObstacle:!1},{id:"missile",name:"Missile",type:"missile",range:1050,dps:18,cd:.7,speed:800,radius:110,desc:"範囲。雑に強い。",pierce:!1,explodeOnObstacle:!0},{id:"grenade",name:"Grenade",type:"lob",range:520,dps:16,cd:.85,speed:620,radius:85,desc:"近〜中。範囲。",pierce:!1,explodeOnObstacle:!0},{id:"blade",name:"Blade",type:"melee",range:120,dps:22,cd:.45,speed:0,desc:"近接。扇型。"},{id:"mine",name:"Mine",type:"mine",range:0,dps:22,cd:1.1,speed:0,radius:120,armMs:240,desc:"設置。踏ませる。"}],ai:[{id:"balanced",name:"Balanced",keep:.75,fleeHp:.18,prefer:"mid",desc:"無難。死ににくい。"},{id:"sniper",name:"Sniper",keep:.95,fleeHp:.12,prefer:"far",desc:"距離を取る。"},{id:"berserker",name:"Berserker",keep:.35,fleeHp:.08,prefer:"near",desc:"突っ込む。死にやすい。"},{id:"coward",name:"Coward",keep:.98,fleeHp:.35,prefer:"far",desc:"逃げる。稼げない。"},{id:"hunter",name:"Hunter",keep:.65,fleeHp:.1,prefer:"mid",desc:"近い敵を確実に。"}]},Je=Object.fromEntries(Ge.weapons.map(f=>[f.id,f])),oa=Object.fromEntries(Ge.frames.map(f=>[f.id,f])),da=Object.fromEntries(Ge.ai.map(f=>[f.id,f])),ca=(f,I)=>{let T=null;const m=I.debug,X=I.toast,V=I.mechLog;function F(t,i,n){return t<i?i:t>n?n:t}function re(t,i,n,c){var l=c===1?10:c===2?18:6,x=c===2?16732120:16777215,G=t.add.circle(i,n,l,x,c===2?.18:.22);G.setBlendMode(Phaser.BlendModes.ADD),G.setDepth(5),t.tweens.add({targets:G,alpha:0,duration:160,onComplete:function(){G.active&&G.destroy()}})}function Z(t,i,n){var c=t.cameras.main,l=c.width,x=c.height,G=Math.min(l,x),D=Math.max(6,Math.round(G*.02)),k=Math.max(2,Math.round(G*.008)),H=k,a=Math.max(96,Math.round(x*.15)),v=x-a-k;t.topPanelG&&t.topPanelG.clear();var e=Math.floor((n||0)*1e3),S=Math.floor(n||0),o=String(Math.floor(S/60)).padStart(2,"0"),w=String(S%60).padStart(2,"0");if(t.waveTimeText&&(t.waveTimeText.setText("W"+String(i.wave||1)+"  "+o+":"+w),t.waveTimeText.setPosition(k+D,H+D),t.waveTimeText.setVisible(!0),t.waveTimeText.setAlpha(1)),t.bottomPanelG&&t.bottomPanelG.clear(),t.mechInfoText){var s=i.cfg.frame?i.cfg.frame.name:"-",d=i.cfg.ai?i.cfg.ai.name:"-";t.mechInfoText.setText("FRAME "+s+"   AI "+d),t.mechInfoText.setWordWrapWidth(Math.round(l*.55),!0),t.mechInfoText.setPosition(k+D,v+a-k-8),t.mechInfoText.setVisible(!0),t.mechInfoText.setAlpha(.9)}if(t.hpGroup){var r=Math.max(0,i.hp|0),y=Math.max(1,i.hpMax??i.maxHp??1),p=Math.max(0,(i.exp??i.score??0)|0);if(t.hpText.setText("HP "+r+"/"+y),t.expText.setText("EXP "+p),t.hpText.setPosition(0,0),t.expText.setPosition(0,30),t.hpGroup.setPosition(k+D,v+D),t.hpGroup.setVisible(!0),t.hpGroup.setAlpha(1),t.hpBarG&&t.expBarG){var b=Math.max(128,Math.round(l*.32));t.hpBarG.clear(),t.hpBarG.fillStyle(16777215,.12),t.hpBarG.fillRoundedRect(0,22,b,12,6),t.hpBarG.fillStyle(65484,.8),t.hpBarG.fillRoundedRect(0,22,Math.max(6,b*F(r/y,0,1)),12,6),t.expBarG.clear(),t.expBarG.fillStyle(16777215,.08),t.expBarG.fillRoundedRect(0,52,b,8,5),t.expBarG.fillStyle(16765803,.55),t.expBarG.fillRoundedRect(0,52,Math.max(6,b*F(p%100/100,0,1)),8,5)}}if(t.weaponGroup){var P=i.cfg.wpnA?i.cfg.wpnA.name:"A",L=i.cfg.wpnB?i.cfg.wpnB.name:"B",U=function($){return $.length>16?$.slice(0,15)+"…":$},Y=Math.max(140,Math.round(l*.28));t.weaponMainText.setText("MAIN "+U(P)),t.weaponSubText.setText("SUB "+U(L)),t.weaponMainText.setPosition(24,0),t.weaponSubText.setPosition(24,22),t.weaponGroup.setPosition(l-k-D-Y,v+D),t.weaponGroup.setVisible(!0),t.weaponGroup.setAlpha(1),t.weaponG&&(t.weaponG.clear(),t.weaponG.fillStyle(65484,.9),t.weaponG.fillRoundedRect(0,2,16,16,4),t.weaponG.fillStyle(6728447,.9),t.weaponG.fillRoundedRect(0,24,16,16,4))}if(t.scorePanelG&&t.scoreLabelText&&t.scoreValueText){t.scoreLabelText.setText("SCORE"),t.scoreValueText.setText(String(i.score|0));var h=8,u=Math.max(t.scoreLabelText.width,t.scoreValueText.width)+h*2,B=t.scoreLabelText.height+t.scoreValueText.height+8,A=l-u-k,R=H+k;t.scorePanelG.clear(),t.scorePanelG.fillStyle(0,.45),t.scorePanelG.fillRoundedRect(A,R,u,B,12),t.scorePanelG.lineStyle(2,65484,.16),t.scorePanelG.strokeRoundedRect(A,R,u,B,12),t.scoreLabelText.setPosition(A+h,R+4),t.scoreValueText.setPosition(A+h,R+4+t.scoreLabelText.height),t.scoreLabelText.setVisible(!0),t.scoreValueText.setVisible(!0),t.scoreLabelText.setAlpha(1),t.scoreValueText.setAlpha(1)}if(t.radarG){var K=Math.round(Math.min(48,Math.max(36,l*.13)));t.radarR=K,t.radarX=l-K-k-D,t.radarY=v-K-D-4}t.prevScore!==(i.score|0)&&(t.prevScore=i.score|0,t.scoreValueText&&t.tweens.add({targets:t.scoreValueText,scale:1.12,duration:120,yoyo:!0,ease:"Quad.out"})),t.prevHp!=null&&(i.hp|0)<(t.prevHp|0)&&t.hpGroup&&t.tweens.add({targets:t.hpGroup,alpha:.4,duration:120,yoyo:!0,repeat:1}),t.prevHp=i.hp|0,i.battleTimeMs=e}function j(t,i,n,c,l){if(!t.obstacles)return!1;var x=new Phaser.Geom.Line(i,n,c,l),G=t.obstacles.getChildren(),D=c-i,k=l-n,H=Math.sqrt(D*D+k*k);if(H<1)return!1;for(var a=0;a<G.length;a++){var v=G[a];if(v.active){var e=v.body;if(e){var S=e.x+e.width*.5,o=e.y+e.height*.5,w=S-i,s=o-n,d=Math.sqrt(w*w+s*s);if(!(d<34)&&!(d>H-10)){var r=new Phaser.Geom.Rectangle(e.x,e.y,e.width,e.height);if(Phaser.Geom.Intersects.LineToRectangle(x,r))return!0}}}}return!1}function z(t,i,n,c,l){if(!t.obstacles)return null;for(var x=new Phaser.Geom.Line(i,n,c,l),G=t.obstacles.getChildren(),D=null,k=1e9,H=0;H<G.length;H++){var a=G[H];if(!(!a.active||!a.body)){var v=a.body,e=new Phaser.Geom.Rectangle(v.x,v.y,v.width,v.height);if(Phaser.Geom.Intersects.LineToRectangle(x,e)){var S=v.x+v.width*.5,o=v.y+v.height*.5,w=Phaser.Math.Distance.Between(i,n,S,o);w<k&&(k=w,D=a)}}}return D}function J(t,i,n,c){var l=t.make.graphics({x:0,y:0,add:!1});l.clear(),l.fillStyle(c,1),l.fillTriangle(n/2,1,1,n-1,n-1,n-1),l.generateTexture(i,n,n),l.destroy()}function me(t,i,n,c){var l=t.make.graphics({x:0,y:0,add:!1});l.clear(),l.fillStyle(0,.35),l.fillCircle(n/2+1,n/2+1,n/2),l.fillStyle(c,1),l.fillCircle(n/2,n/2,n/2-1),l.generateTexture(i,n,n),l.destroy()}function ye(t,i,n,c,l){var x=t.make.graphics({x:0,y:0,add:!1});x.clear(),x.fillStyle(l,1),x.fillRoundedRect(0,0,n,c,10),x.lineStyle(2,16777215,.12),x.strokeRoundedRect(2,2,n-4,c-4,8),x.lineStyle(1,65484,.1),x.beginPath(),x.moveTo(8,c*.35),x.lineTo(n-8,c*.35),x.moveTo(8,c*.65),x.lineTo(n-8,c*.65),x.strokePath(),x.generateTexture(i,n,c),x.destroy()}function De(t,i,n){var c=t.make.graphics({x:0,y:0,add:!1});c.clear(),c.fillStyle(724758,1),c.fillCircle(n/2,n/2,n/2),c.lineStyle(2,65484,.55),c.strokeCircle(n/2,n/2,n/2-2),c.fillStyle(65484,.18),c.fillCircle(n/2,n/2,n/2-4),c.generateTexture(i,n,n),c.destroy()}function ke(t){if(T){try{T.destroy(!0)}catch{}T=null}var i=430,n=820,c={type:Phaser.AUTO,parent:"game",width:i,height:n,backgroundColor:"#05070b",physics:{default:"arcade",arcade:{debug:!1,gravity:{y:0}}},scene:{preload:x,create:G,update:H}};const l={cfg:t,hp:t.frame.hp,hpMax:t.frame.hp,en:t.frame.en,enMax:t.frame.en,enRegen:t.frame.enRegen,speed:t.frame.speed,score:0,t0:0,lastA:0,lastB:0,target:null,lastSwitch:0,targetDist:0,lastDelta:0,dead:!1};function x(){J(this,"p",30,65484),J(this,"e",26,16731469),me(this,"ba",10,65484),me(this,"bb",10,16732120),De(this,"mn",22),ye(this,"obA",140,90,2765892),ye(this,"obB",220,130,2305082),ye(this,"obC",110,180,2568772)}function G(){m("scene.create");var a=this;a.rangeTexts||(a.rangeTexts=[]),a.lockG||(a.lockG=a.add.graphics().setDepth(4)),a.radarG||(a.radarG=a.add.graphics().setScrollFactor(0).setDepth(10),a.radarX=320,a.radarY=120,a.radarR=58,a.radarRange=900),l.t0=a.time.now,a.physics.world.setBounds(-4e3,-4e3,8e3,8e3),a.player=a.physics.add.image(0,0,"p"),a.player.setDepth(2),a.player.setCircle(10),a.enemies=a.physics.add.group(),a.spawnAcc=0,a.spawnInterval=.85;function v(){var h=Math.random()*Math.PI*2,u=520+Math.random()*520,B=a.player.x+Math.cos(h)*u,A=a.player.y+Math.sin(h)*u,R=a.enemies.create(B,A,"e");return R.setData("hp",18),R.setData("blocked",!1),R.setRotation(Phaser.Math.Angle.Between(B,A,a.player.x,a.player.y)+Math.PI/2),R.setCollideWorldBounds(!1),R.setDepth(1),R}for(var e=0;e<6;e++)v();m("spawn init enemies="+a.enemies.getChildren().length),a.obsSpawnAcc=0,a.obsSpawnInterval=2.2,a.bullets=a.physics.add.group(),a.mines=a.physics.add.group(),a.obstacles=a.physics.add.staticGroup();for(var S=["obA","obB","obC"],o=0;o<25;o++){var w=Math.random()*Math.PI*2,s=280+Math.random()*1400,d=a.player.x+Math.cos(w)*s,r=a.player.y+Math.sin(w)*s,y=S[Math.random()*S.length|0],p=a.obstacles.create(d,r,y),b=p.body&&p.body.width?p.body.width:p.displayWidth||60,P=p.body&&p.body.height?p.body.height:p.displayHeight||60,L=Math.max(30,Math.floor(b*P/10));p.setData("maxHp",L),p.setData("hp",L),p.setAlpha(.55),p.setAlpha(.85),p.setRotation((Math.random()*2-1)*.18),p.setDepth(0),p.refreshBody()}a.obAcc=0,a.mechInfoText=a.add.text(0,0,"",{fontFamily:"system-ui, sans-serif",fontSize:"16px",fontStyle:"700",fill:"#e8eefc",stroke:"#000",strokeThickness:5}).setScrollFactor(0).setDepth(12).setOrigin(0,1),a.barG=a.add.graphics().setScrollFactor(0).setDepth(10),a.rangeG=a.add.graphics().setDepth(0),a.lockG=a.add.graphics().setDepth(4),a.rangeTexts=[],a.radarG=a.add.graphics().setScrollFactor(0).setDepth(10),a.radarX=320,a.radarY=120,a.radarR=58,a.radarRange=900,a.cameras.main.startFollow(a.player,!0,.12,.12);var U=Math.max(l.cfg.wpnA.range||0,l.cfg.wpnB.range||0,520),Y=F(680/U,.45,.9);a.cameras.main.setZoom(Y),a.physics.add.overlap(a.bullets,a.enemies,function(h,u){if(!(!h.active||!u.active)){re(a,h.x,h.y,h.getData("pierce")?1:0);var B=h.getData("dmg")||6,A=u.getData("hp")||20;A-=B,u.setData("hp",A),h.destroy(),A<=0&&(u.destroy(),l.score+=1,l.kills=(l.kills||0)+1,V("kill",l.battleTimeMs||0,"KILL ("+(h.getData("weaponName")||"WEAPON")+")"))}}),a.physics.add.overlap(a.bullets,a.obstacles,function(h,u){if(!(!h.active||!u.active)){var B=h.getData("bornAt")||0;if(!(B&&a.time.now-B<60)){var A=h.getData("aoe")||0,R=h.getData("dmg")||10;if(A>0&&h.getData("explodeOnObstacle")){re(a,h.x,h.y,2);var K=a.add.circle(h.x,h.y,A,16732120,.14);K.setBlendMode(Phaser.BlendModes.ADD),a.time.delayedCall(180,function(){K.active&&K.destroy()})}else re(a,h.x,h.y,1);var $=u.getData("hp"),ee=u.getData("maxHp")||60;typeof $!="number"&&($=ee),$-=R,u.setData("hp",$);var E=Math.max(0,$/ee);if(u.setAlpha(.25+E*.45),u.setTint){var q=E<.5?9082293:7306918;E<.25&&(q=9132634),u.setTint(q)}$<=0&&(re(a,u.x,u.y,2),u.destroy(),V("obj",l.battleTimeMs||0,"OBJECT DESTROYED")),h.destroy()}}}),a.physics.add.collider(a.player,a.obstacles),a.physics.add.collider(a.enemies,a.obstacles),a.input.on("pointerdown",function(h){if(!l.dead){var u=Phaser.Math.Angle.Between(a.player.x,a.player.y,h.worldX,h.worldY);a.player.rotation=u+Math.PI/2,a.physics.velocityFromRotation(u,l.speed,a.player.body.velocity)}}),a.spawnAcc=0,a.dmgAcc=0,X("BATTLE STARTED"),m("Battle started")}function D(a){for(var v=a.enemies.getChildren(),e=0;e<2;e++){for(var S=null,o=1e18,w=0;w<v.length;w++){var s=v[w];if(s.active){var d=j(a,a.player.x,a.player.y,s.x,s.y);if(!(e===0&&d)){var r=s.x-a.player.x,y=s.y-a.player.y,p=r*r+y*y;p<o&&(o=p,S=s)}}}if(S)return S}return null}function k(a,v,e,S){if(!l.dead&&!(!l.target||!l.target.active)){var o=v,w=l.target,s=a.player.x,d=a.player.y,r=w.x,y=w.y,p=Phaser.Math.Distance.Between(s,d,r,y);if(!(o.range>0&&p>o.range)){if(o.type!=="melee"&&o.type!=="mine"){var b=j(a,s,d,r,y);if(b){var P=z(a,s,d,r,y);if(P&&P.active)r=P.x,y=P.y,P.body&&(r=P.body.x+P.body.width*.5,y=P.body.y+P.body.height*.5),a._breakCoverAcc=(a._breakCoverAcc||0)+(l.lastDelta||0),a._breakCoverAcc>1200&&(a._breakCoverAcc=0,V("obj",l.battleTimeMs||0,"BREAK COVER → obstacle"));else return}}if(o.type==="melee"){var L=Math.PI*.65,U=Phaser.Math.Angle.Between(s,d,r,y);a.player.rotation=U+Math.PI/2,a.slashG||(a.slashG=a.add.graphics(),a.slashG.setDepth(2)),a.slashG.clear(),a.slashG.fillStyle(65484,.1),a.slashG.lineStyle(2,65484,.28),a.slashG.beginPath(),a.slashG.slice(s,d,o.range,U-L/2,U+L/2,!1),a.slashG.closePath(),a.slashG.fillPath(),a.slashG.strokePath(),a.time.delayedCall(90,function(){a.slashG&&a.slashG.clear()});for(var Y=a.enemies.getChildren(),h=Math.max(10,Math.floor(o.dps*o.cd)),u=0;u<Y.length;u++){var B=Y[u];if(B.active){var A=B.x-s,R=B.y-d,K=Math.sqrt(A*A+R*R);if(!(K>o.range)){var $=Math.atan2(R,A),ee=Phaser.Math.Angle.Wrap($-U);Math.abs(ee)<=L/2&&(B.setData("hp",(B.getData("hp")||20)-h),B.getData("hp")<=0&&(B.destroy(),l.score+=1))}}}return}if(o.type==="mine"){var E=a.physics.add.image(s,d,"mn");E.setDepth(1),E.setCircle(10),E.body.setImmovable(!0),E.body.setVelocity(0,0),E.setAlpha(.55),E.setData("armed",!1),E.setData("armAt",e+(o.armMs||240)),E.setData("radius",o.radius||120),E.setData("dmg",Math.max(12,Math.floor(o.dps*.9))),a.mines.add(E);return}var q=Phaser.Math.Angle.Between(s,d,r,y);a.player.rotation=q+Math.PI/2;var fe=Math.cos(q)*26,ve=Math.sin(q)*26,M=a.physics.add.image(s+fe,d+ve,S);M.setDepth(3),M.setCircle(4),M.setData("dmg",Math.max(6,Math.floor(o.dps*o.cd))),M.setData("bornAt",e),M.setData("pierce",!!o.pierce),M.setData("explodeOnObstacle",!!o.explodeOnObstacle),a.bullets.add(M),a.physics.velocityFromRotation(q,o.speed||1e3,M.body.velocity);var Me=Math.floor((o.range||900)/(o.speed||1e3)*1e3)+1200;a.time.delayedCall(Me,function(){M.active&&M.destroy()}),(o.type==="lob"||o.type==="missile")&&(M.setData("aoe",o.radius||90),M.setData("explodeOnObstacle",!!o.explodeOnObstacle))}}}function H(a,v){var e=this,S=l.startMs!=null?(e.time.now-l.startMs)/1e3:0;l.lastDelta=v;try{if(e._dbgAcc=(e._dbgAcc||0)+v,e._dbgAcc>700&&(e._dbgAcc=0,m("tick "+Math.floor(a))),l.dead)return;if(l.en=F(l.en+l.enRegen*(v/1e3),0,l.enMax),e.spawnAcc+=v/1e3,e.spawnAcc>=e.spawnInterval&&(e.spawnAcc=0,e.enemies.getChildren().length<26)){var o=Math.random()*Math.PI*2,w=560+Math.random()*660,s=e.player.x+Math.cos(o)*w,d=e.player.y+Math.sin(o)*w,r=e.enemies.create(s,d,"e");r.setData("hp",18),r.setData("blocked",!1),r.setRotation(Phaser.Math.Angle.Between(s,d,e.player.x,e.player.y)+Math.PI/2),r.setDepth(1)}e._cntAcc=(e._cntAcc||0)+v,e._cntAcc>2500&&(e._cntAcc=0,m("counts enemies="+e.enemies.getChildren().length+" obstacles="+(e.obstacles?e.obstacles.getChildren().length:0)+" bullets="+e.bullets.getChildren().length));for(var _=e.enemies&&e.enemies.getChildren?e.enemies.getChildren():[],y=0;y<_.length;y++){var r=_[y];if(!(!r.active||!r.body)){var p=Phaser.Math.Angle.Between(r.x,r.y,e.player.x,e.player.y),b=r.body.velocity.x,P=r.body.velocity.y,L=b*b+P*P,U=r.body.blocked&&(r.body.blocked.left||r.body.blocked.right||r.body.blocked.up||r.body.blocked.down)||r.body.touching&&(r.body.touching.left||r.body.touching.right||r.body.touching.up||r.body.touching.down)||L<40,Y=r.getData("turnBias")||0,h=r.getData("turnBiasT")||0;(U||h<=0)&&(Y=(Math.random()<.5?-1:1)*(.35+Math.random()*.35),h=220+Math.random()*260),h-=v,r.setData("turnBias",Y),r.setData("turnBiasT",h);var u=p+(h>0?Y:0),B=74,A=Phaser.Math.Distance.Between(r.x,r.y,e.player.x,e.player.y),R=B+(A<260?26:0);r.body.setVelocity(Math.cos(u)*R,Math.sin(u)*R),r.rotation=u+Math.PI/2}}var Be=e.mines&&e.mines.getChildren?e.mines.getChildren():[],K=e.obstacles&&e.obstacles.getChildren?e.obstacles.getChildren():[];if(e.obsSpawnAcc+=v/1e3,e.obsSpawnAcc>=e.obsSpawnInterval){e.obsSpawnAcc=0;var $=e.obstacles&&e.obstacles.getChildren?e.obstacles.getChildren():[];if($.length<70){for(var ee=0,E=0;E<$.length;E++){var q=$[E];q.active&&Phaser.Math.Distance.Between(q.x,q.y,e.player.x,e.player.y)<520&&ee++}if(ee<12){var o=Math.random()*Math.PI*2,w=360+Math.random()*560,s=e.player.x+Math.cos(o)*w,d=e.player.y+Math.sin(o)*w,fe=70+Math.random()*160,ve=50+Math.random()*150,M=e.obstacles.create(s,d,"ob");M.setImmovable(!0),M.body&&typeof M.body.setAllowGravity=="function"&&M.body.setAllowGravity(!1),M.body&&typeof M.body.setSize=="function"&&M.body.setSize(fe,ve,!0),M.displayWidth=fe,M.displayHeight=ve;var Me=Math.max(30,Math.floor(fe*ve/10));M.setData("maxHp",Me),M.setData("hp",Me),M.setAlpha(.55),typeof M.refreshBody=="function"&&M.refreshBody()}}}var g=l.target;if(g&&!g.active&&(g=null),!g)g=D(e),g&&(l.target=g,l.lastSwitch=a);else if(a-l.lastSwitch>=1e3){var le=D(e);if(le&&le!==g){var Qe=Phaser.Math.Distance.Between(e.player.x,e.player.y,g.x,g.y),Ze=Phaser.Math.Distance.Between(e.player.x,e.player.y,le.x,le.y);Ze+40<Qe&&(g=le,l.target=le,l.lastSwitch=a)}}l.targetDist=g&&g.active?Math.floor(Phaser.Math.Distance.Between(e.player.x,e.player.y,g.x,g.y)):0;for(var Ae=0;Ae<_.length;Ae++){var ue=_[Ae];if(ue.active){var se=j(e,e.player.x,e.player.y,ue.x,ue.y);ue.setAlpha(se?.18:1),ue.setData("blocked",se)}}if(e.lockG.clear(),g&&g.active){e.lockG.lineStyle(2,16722731,.55),e.lockG.beginPath(),e.lockG.moveTo(e.player.x,e.player.y),e.lockG.lineTo(g.x,g.y),e.lockG.strokePath(),e.lockG.fillStyle(16722731,.9);var we=7;e.lockG.beginPath(),e.lockG.moveTo(g.x,g.y-we),e.lockG.lineTo(g.x+we,g.y),e.lockG.lineTo(g.x,g.y+we),e.lockG.lineTo(g.x-we,g.y),e.lockG.closePath(),e.lockG.fillPath()}for(var _=e.enemies.getChildren(),Pe=0;Pe<_.length;Pe++){var r=_[Pe];if(r.active){var Ne=Phaser.Math.Angle.Between(r.x,r.y,e.player.x,e.player.y),ze=r.getData("spd")||180;e.physics.velocityFromRotation(Ne,ze,r.body.velocity),r.rotation=Ne+Math.PI/2;var A=Phaser.Math.Distance.Between(r.x,r.y,e.player.x,e.player.y);A<22&&(l.hp-=.2*(v/16.666))}}for(var Be=e.mines.getChildren(),Re=0;Re<Be.length;Re++){var O=Be[Re];if(O.active&&(!O.getData("armed")&&a>=(O.getData("armAt")||0)&&(O.setData("armed",!0),O.setAlpha(.95)),O.getData("armed")))for(var Ce=O.getData("radius")||120,Ue=Ce*Ce,y=0;y<_.length;y++){var Ie=_[y];if(Ie.active){var ne=Ie.x-O.x,ie=Ie.y-O.y;if(ne*ne+ie*ie<=Ue){for(var ea=O.getData("dmg")||18,Le=0;Le<_.length;Le++){var ae=_[Le];if(ae.active){var qe=ae.x-O.x,Ye=ae.y-O.y;qe*qe+Ye*Ye<=Ue&&(ae.setData("hp",(ae.getData("hp")||20)-ea),ae.getData("hp")<=0&&(ae.destroy(),l.score+=1))}}var Ee=e.add.circle(O.x,O.y,Ce,65484,.18);Ee.setBlendMode(Phaser.BlendModes.ADD),e.time.delayedCall(180,function(){Ee.active&&Ee.destroy()}),O.destroy();break}}}}if(g&&g.active){var $e=l.cfg.ai,Fe=$e.prefer,aa=Phaser.Math.Distance.Between(e.player.x,e.player.y,g.x,g.y),Te=360;Fe==="near"&&(Te=220),Fe==="mid"&&(Te=380),Fe==="far"&&(Te=520);var ta=l.hp/l.hpMax<$e.fleeHp,Oe=Phaser.Math.Angle.Between(e.player.x,e.player.y,g.x,g.y),ge=1;ta||aa<Te*$e.keep?ge=-1:ge=1,e.physics.velocityFromRotation(Oe,l.speed*.85*ge,e.player.body.velocity),e.player.rotation=ge===1?Oe+Math.PI/2:Oe-Math.PI/2}var oe=l.cfg.wpnA,de=l.cfg.wpnB;a-l.lastA>=oe.cd*1e3&&(l.lastA=a,k(e,oe,a,"ba")),a-l.lastB>=de.cd*1e3&&(l.lastB=a,k(e,de,a,"bb")),e.rangeG.clear();for(var ra=Math.max(oe.range||0,de.range||0,0),Ke=200,Xe=Math.max(1,Math.floor(ra/Ke));e.rangeTexts.length<Xe;){var je=e.add.text(0,0,"",{fontFamily:"system-ui, sans-serif",fontSize:"13px",fill:"#e8eefc",stroke:"#000",strokeThickness:3});je.setDepth(9),e.rangeTexts.push(je)}for(var He=0;He<e.rangeTexts.length;He++)e.rangeTexts[He].setVisible(!1);for(var Se=1;Se<=Xe;Se++){var be=Se*Ke;e.rangeG.lineStyle(1,16777215,.08),e.rangeG.strokeCircle(e.player.x,e.player.y,be);var o=-Math.PI/4,la=e.player.x+Math.cos(o)*be,sa=e.player.y+Math.sin(o)*be,Ve=e.rangeTexts[Se-1];Ve.setText(String(be)),Ve.setPosition(la+6,sa-10),Ve.setVisible(!0)}if(oe.range&&oe.range>0&&(e.rangeG.lineStyle(2,65484,.2),e.rangeG.strokeCircle(e.player.x,e.player.y,oe.range)),de.range&&de.range>0&&(e.rangeG.lineStyle(2,16732120,.18),e.rangeG.strokeCircle(e.player.x,e.player.y,de.range)),e.radarG){e.radarG.clear();var ce=e.radarX,pe=e.radarY,he=e.radarR;e.radarG.fillStyle(0,.35),e.radarG.fillCircle(ce,pe,he+8),e.radarG.lineStyle(2,65484,.22),e.radarG.strokeCircle(ce,pe,he),e.radarG.lineStyle(1,16777215,.08),e.radarG.strokeCircle(ce,pe,he*.66),e.radarG.strokeCircle(ce,pe,he*.33),e.radarG.fillStyle(65484,.9),e.radarG.fillCircle(ce,pe,3);for(var _e=e.radarRange,We=0;We<_.length;We++){var r=_[We];if(r.active){var ne=r.x-e.player.x,ie=r.y-e.player.y,w=Math.sqrt(ne*ne+ie*ie);if(!(w>_e)){var na=ce+ne/_e*he,ia=pe+ie/_e*he,se=!!r.getData("blocked");e.radarG.fillStyle(se?16732120:16722731,se?.7:.85),e.radarG.fillCircle(na,ia,se?2:2.5)}}}}var W=1e3;e.scorePanelG=e.add.graphics().setScrollFactor(0).setDepth(W),e.scoreLabelText=e.add.text(0,0,"SCORE",{fontFamily:"system-ui, sans-serif",fontSize:"12px",fontStyle:"700",fill:"#b8c6ff",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(W+1),e.scoreValueText=e.add.text(0,0,"0",{fontFamily:"system-ui, sans-serif",fontSize:"22px",fontStyle:"700",fill:"#e8eefc",stroke:"#000",strokeThickness:4}).setScrollFactor(0).setDepth(W+1),e.waveTimeText=e.add.text(0,0,"W1  00:00",{fontFamily:"system-ui, sans-serif",fontSize:"14px",fontStyle:"700",fill:"#e8eefc",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(W+1),e.hpText=e.add.text(0,0,"HP 0/0",{fontFamily:"system-ui, sans-serif",fontSize:"18px",fontStyle:"700",fill:"#e8eefc",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(W+1),e.expText=e.add.text(0,0,"EXP 0",{fontFamily:"system-ui, sans-serif",fontSize:"14px",fontStyle:"700",fill:"#ffd36b",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(W+1),e.hpBarG=e.add.graphics().setScrollFactor(0).setDepth(W),e.expBarG=e.add.graphics().setScrollFactor(0).setDepth(W),e.hpGroup=e.add.container(0,0,[e.hpText,e.expText,e.hpBarG,e.expBarG]).setScrollFactor(0).setDepth(W+1),e.weaponMainText=e.add.text(0,0,"MAIN",{fontFamily:"system-ui, sans-serif",fontSize:"13px",fill:"#e8eefc",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(W+1),e.weaponSubText=e.add.text(0,0,"SUB",{fontFamily:"system-ui, sans-serif",fontSize:"13px",fill:"#e8eefc",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(W+1),e.weaponG=e.add.graphics().setScrollFactor(0).setDepth(W+1),e.weaponGroup=e.add.container(0,0,[e.weaponG,e.weaponMainText,e.weaponSubText]).setScrollFactor(0).setDepth(W+1),Z(e,l,S),l.hp<=0&&(l.dead=!0,l.hp=0,xe(l.score,Math.floor(S||0),l.cfg))}catch(te){m("EXCEPTION: "+(te&&te.message?te.message:te)+(te&&te.stack?`
`+te.stack:"")),l.dead=!0}}T=new Phaser.Game(c)}function xe(t,i,n){try{T&&T.scene.pause()}catch{}I.showResult(t,i,n)}return m("bootGame called"),ke(f),{destroy:()=>{try{T&&(T.destroy(!0),T=null)}catch{}}}},C=f=>{const I=document.getElementById(f);if(!I)throw new Error(`Missing required element: ${f}`);return I},pa=f=>{let T=Math.max(0,f|0);const m=Math.floor(T/36e5);T-=m*36e5;const X=Math.floor(T/6e4);T-=X*6e4;const V=Math.floor(T/1e3),F=T-V*1e3;return`${String(m).padStart(2,"0")}:${String(X).padStart(2,"0")}:${String(V).padStart(2,"0")}.${String(F).padStart(3,"0")}`},ha=f=>f.replace(/[&<>"]/g,I=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[I]??I),ya=f=>{const I=C("debugBtn"),T=C("debugPanel"),m=C("mechLogPanel"),X=C("mechLogLines"),V=C("startPanel"),F=C("resultPanel"),re=C("toast"),Z=C("selFrame"),j=C("selWpnA"),z=C("selWpnB"),J=C("selAI"),me=C("frameDesc"),ye=C("wpnADesc"),De=C("wpnBDesc"),ke=C("aiDesc"),xe=C("kpi"),t=C("resultText"),i=C("resultKpi"),n=C("btnStart"),c=C("btnRetry");let l=!1;const x=[],G=[],D=window.location.hostname==="localhost"||window.location.search.includes("debug=1");document.body.classList.toggle("is-debug",D),I.style.display=D?"block":"none";const k=()=>{const d=G.map((r,y)=>{const p=y===G.length-1?"is-latest":"is-old";return`<div class='line ${r.cls} ${p}'>${pa(r.t)} ${ha(r.msg)}</div>`});for(;d.length<5;)d.push("<div class='line placeholder'>&nbsp;</div>");X.innerHTML=d.join("")};m.style.display="none",m.style.visibility="hidden",k();const H=s=>{const d=new Date().toISOString().slice(11,19);x.push(`[${d}] ${s}`),x.length>200&&x.shift(),T.textContent=x.join(`
`)},a=s=>{re.textContent=String(s)},v=(s,d,r)=>{m.style.display="block",m.style.visibility="visible";const y=`c-${s??"sys"}`;G.push({t:d|0,cls:y,msg:r}),G.length>5&&G.shift(),k(),m.style.opacity="0",requestAnimationFrame(()=>{m.style.opacity="0.8"}),window.clearTimeout(m.__fadeTimer),m.__fadeTimer=window.setTimeout(()=>{m.style.opacity="0.35"},2500)},e=(s,d)=>{s.innerHTML="",d.forEach(r=>{const y=document.createElement("option");y.value=r.id,y.textContent=r.name??r.id,s.appendChild(y)})},S=()=>{const s=f.frames.find(b=>b.id===Z.value),d=f.weapons.find(b=>b.id===j.value),r=f.weapons.find(b=>b.id===z.value),y=f.ai.find(b=>b.id===J.value);if(!s||!d||!r||!y)return;me.textContent=`${s.desc}  (HP ${s.hp} / SPD ${s.speed})`,ye.textContent=`${d.desc}  (R ${d.range} / DPS ${d.dps})`,De.textContent=`${r.desc}  (R ${r.range} / DPS ${r.dps})`,ke.textContent=y.desc,xe.innerHTML="";const p=(b,P)=>{const L=document.createElement("div");L.className=`pill ${P??""}`.trim(),L.textContent=b,xe.appendChild(L)};p(`FRAME: ${s.name}`,"good"),p(`MAIN: ${d.name}`),p(`SUB: ${r.name}`),p(`AI: ${y.name}`)};return e(Z,f.frames),e(j,f.weapons),e(z,f.weapons),e(J,f.ai),Z.value="middle",j.value="mg",z.value="cannon",J.value="balanced",Z.addEventListener("change",S),j.addEventListener("change",S),z.addEventListener("change",S),J.addEventListener("change",S),S(),V.classList.remove("hidden"),V.style.display="flex",F.classList.add("hidden"),F.style.display="none",m.style.display="none",m.style.visibility="hidden",D&&I.addEventListener("click",()=>{l=!l,T.style.display=l?"block":"none"}),window.addEventListener("error",s=>{var r;const d=s!=null&&s.message?s.message:String(s);H(`ERROR: ${d}${(r=s==null?void 0:s.error)!=null&&r.stack?`
${s.error.stack}`:""}`),a(`ERROR: ${d}`)}),{onStart:s=>n.addEventListener("click",s),onRetry:s=>c.addEventListener("click",s),hideStart:()=>{V.classList.add("hidden"),V.style.display="none",m.style.display="block",m.style.visibility="visible"},showStart:()=>{V.classList.remove("hidden"),V.style.display="flex",F.classList.add("hidden"),F.style.display="none",m.style.display="none",m.style.visibility="hidden"},hideResult:()=>{F.classList.add("hidden"),F.style.display="none"},showResultPanel:()=>{F.classList.remove("hidden"),F.style.display="flex",m.style.display="none",m.style.visibility="hidden"},getConfig:()=>({frameId:Z.value,wpnAId:j.value,wpnBId:z.value,aiId:J.value}),setToast:a,setDebug:H,pushMechLog:v,renderResult:(s,d,r)=>{const y=`SCORE: ${s}
TIME: ${d}s
FRAME: ${r.frame.name} / AI: ${r.ai.name}
MAIN: ${r.wpnA.name} / SUB: ${r.wpnB.name}`;t.textContent=y,i.innerHTML="";const p=(b,P)=>{const L=document.createElement("div");L.className=`pill ${P??""}`.trim(),L.textContent=b,i.appendChild(L)};p(`SCORE ${s}`,"good"),p(`TIME ${d}s`),p(r.frame.name),p(r.ai.name),p(`MAIN ${r.wpnA.name}`),p(`SUB ${r.wpnB.name}`,"bad")}}},N=ya(Ge),fa=f=>{const I=oa[f.frameId],T=Je[f.wpnAId],m=Je[f.wpnBId],X=da[f.aiId];if(!I||!T||!m||!X)throw new Error("Invalid loadout selection.");return{frame:I,wpnA:T,wpnB:m,ai:X}};let Q=null;const va={toast:N.setToast,debug:N.setDebug,mechLog:N.pushMechLog,showResult:(f,I,T)=>{N.renderResult(f,I,T),N.showResultPanel()}};N.onStart(()=>{N.hideResult(),N.hideStart();const f=fa(N.getConfig());Q==null||Q.destroy(),Q=ca(f,va)});N.onRetry(()=>{N.hideResult(),N.showStart(),Q==null||Q.destroy(),Q=null,N.setToast("READY")});
