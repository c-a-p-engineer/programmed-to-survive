import"./modulepreload-polyfill-B5Qt9EMX.js";const Ge={frames:[{id:"light",name:"LIGHT",hp:70,speed:240,en:100,enRegen:18,desc:"高速。薄い。回避で生きる。"},{id:"middle",name:"MIDDLE",hp:95,speed:210,en:120,enRegen:14,desc:"標準。バランス。"},{id:"heavy",name:"HEAVY",hp:130,speed:175,en:140,enRegen:11,desc:"鈍い。硬い。詰みづらい。"}],weapons:[{id:"mg",name:"Machinegun",type:"bullet",range:900,dps:14,cd:.1,speed:1e3,desc:"連射。見てて気持ちいい。",pierce:!1,explodeOnObstacle:!1},{id:"cannon",name:"Cannon",type:"bullet",range:1250,dps:22,cd:.55,speed:1250,desc:"高威力。遠距離。",pierce:!1,explodeOnObstacle:!1},{id:"missile",name:"Missile",type:"missile",range:1050,dps:18,cd:.7,speed:800,radius:110,desc:"範囲。雑に強い。",pierce:!1,explodeOnObstacle:!0},{id:"grenade",name:"Grenade",type:"lob",range:520,dps:16,cd:.85,speed:620,radius:85,desc:"近〜中。範囲。",pierce:!1,explodeOnObstacle:!0},{id:"blade",name:"Blade",type:"melee",range:120,dps:22,cd:.45,speed:0,desc:"近接。扇型。"},{id:"mine",name:"Mine",type:"mine",range:0,dps:22,cd:1.1,speed:0,radius:120,armMs:240,desc:"設置。踏ませる。"}],ai:[{id:"balanced",name:"Balanced",keep:.75,fleeHp:.18,prefer:"mid",desc:"無難。死ににくい。"},{id:"sniper",name:"Sniper",keep:.95,fleeHp:.12,prefer:"far",desc:"距離を取る。"},{id:"berserker",name:"Berserker",keep:.35,fleeHp:.08,prefer:"near",desc:"突っ込む。死にやすい。"},{id:"coward",name:"Coward",keep:.98,fleeHp:.35,prefer:"far",desc:"逃げる。稼げない。"},{id:"hunter",name:"Hunter",keep:.65,fleeHp:.1,prefer:"mid",desc:"近い敵を確実に。"}]},je=Object.fromEntries(Ge.weapons.map(v=>[v.id,v])),oa=Object.fromEntries(Ge.frames.map(v=>[v.id,v])),ia=Object.fromEntries(Ge.ai.map(v=>[v.id,v])),ca=(v,I)=>{let D=null;const S=I.debug,X=I.toast,U=I.mechLog;function q(t,o,s){return t<o?o:t>s?s:t}function te(t,o,s,d){var r=d===1?10:d===2?18:6,m=d===2?16732120:16777215,x=t.add.circle(o,s,r,m,d===2?.18:.22);x.setBlendMode(Phaser.BlendModes.ADD),x.setDepth(5),t.tweens.add({targets:x,alpha:0,duration:160,onComplete:function(){x.active&&x.destroy()}})}function Z(t,o,s){var d=t.cameras.main,r=d.width,m=d.height,x=Math.max(2,Math.round(Math.min(r,m)*.015)),T=2,E=0,O=Math.max(40,Math.round(m*.065)),a=Math.max(96,Math.round(m*.15)),y=m-a;t.topPanelG&&(t.topPanelG.clear(),t.topPanelG.fillStyle(0,.62),t.topPanelG.fillRoundedRect(T,E,r-T*2,O,10),t.topPanelG.lineStyle(2,65484,.18),t.topPanelG.strokeRoundedRect(T,E,r-T*2,O,10));var e=Math.floor((s||0)*1e3),G=Math.floor(s||0),i=String(Math.floor(G/60)).padStart(2,"0"),w=String(G%60).padStart(2,"0");if(t.waveTimeText&&(t.waveTimeText.setText("W"+String(o.wave||1)+"  "+i+":"+w),t.waveTimeText.setPosition(T+x,E+x)),t.bottomPanelG&&(t.bottomPanelG.clear(),t.bottomPanelG.fillStyle(0,.55),t.bottomPanelG.fillRoundedRect(2,y,r-4,a,14),t.bottomPanelG.lineStyle(1,65484,.14),t.bottomPanelG.strokeRoundedRect(2,y,r-4,a,14)),t.mechInfoText){var l=o.cfg.wpnA?o.cfg.wpnA.name:"A",c=o.cfg.wpnB?o.cfg.wpnB.name:"B",n=o.cfg.frame?o.cfg.frame.name:"-",f=o.cfg.ai?o.cfg.ai.name:"-";t.mechInfoText.setText("FRAME "+n+"   AI "+f+"   MAIN "+l+"   SUB "+c),t.mechInfoText.setPosition(x+4,y+a-10)}if(t.hpGroup){var p=Math.max(0,o.hp|0),b=Math.max(1,o.hpMax??o.maxHp??1),P=Math.max(0,(o.exp??o.score??0)|0);if(t.hpText.setText("HP "+p+"/"+b),t.expText.setText("EXP "+P),t.hpText.setPosition(0,0),t.expText.setPosition(0,30),t.hpGroup.setPosition(T+x,y+x),t.hpBarG&&t.expBarG){var k=Math.max(128,Math.round(r*.32));t.hpBarG.clear(),t.hpBarG.fillStyle(16777215,.12),t.hpBarG.fillRoundedRect(0,22,k,12,6),t.hpBarG.fillStyle(65484,.8),t.hpBarG.fillRoundedRect(0,22,Math.max(6,k*q(p/b,0,1)),12,6),t.expBarG.clear(),t.expBarG.fillStyle(16777215,.08),t.expBarG.fillRoundedRect(0,52,k,8,5),t.expBarG.fillStyle(16765803,.55),t.expBarG.fillRoundedRect(0,52,Math.max(6,k*q(P%100/100,0,1)),8,5)}}if(t.weaponGroup){var Y=o.cfg.wpnA?o.cfg.wpnA.name:"A",K=o.cfg.wpnB?o.cfg.wpnB.name:"B",h=function(N){return N.length>16?N.slice(0,15)+"…":N};t.weaponMainText.setText("MAIN "+h(Y)),t.weaponSubText.setText("SUB "+h(K)),t.weaponMainText.setPosition(24,0),t.weaponSubText.setPosition(24,22),t.weaponGroup.setPosition(r-T-x-150,y+x),t.weaponG&&(t.weaponG.clear(),t.weaponG.fillStyle(65484,.9),t.weaponG.fillRoundedRect(0,2,16,16,4),t.weaponG.fillStyle(6728447,.9),t.weaponG.fillRoundedRect(0,24,16,16,4))}if(t.scorePanelG&&t.scoreLabelText&&t.scoreValueText){t.scoreLabelText.setText("SCORE"),t.scoreValueText.setText(String(o.score|0));var u=8,A=Math.max(t.scoreLabelText.width,t.scoreValueText.width)+u*2,B=t.scoreLabelText.height+t.scoreValueText.height+8,R=r-A-T,V=E+T;t.scorePanelG.clear(),t.scorePanelG.fillStyle(0,.62),t.scorePanelG.fillRoundedRect(R,V,A,B,12),t.scorePanelG.lineStyle(2,65484,.2),t.scorePanelG.strokeRoundedRect(R,V,A,B,12),t.scoreLabelText.setPosition(R+u,V+4),t.scoreValueText.setPosition(R+u,V+4+t.scoreLabelText.height)}if(t.radarG){var $=Math.round(Math.min(48,Math.max(36,r*.13)));t.radarR=$,t.radarX=r-$-T-x,t.radarY=y-$-x-4}t.prevScore!==(o.score|0)&&(t.prevScore=o.score|0,t.scoreValueText&&t.tweens.add({targets:t.scoreValueText,scale:1.12,duration:120,yoyo:!0,ease:"Quad.out"})),t.prevHp!=null&&(o.hp|0)<(t.prevHp|0)&&t.hpGroup&&t.tweens.add({targets:t.hpGroup,alpha:.4,duration:120,yoyo:!0,repeat:1}),t.prevHp=o.hp|0,o.battleTimeMs=e}function j(t,o,s,d,r){if(!t.obstacles)return!1;var m=new Phaser.Geom.Line(o,s,d,r),x=t.obstacles.getChildren(),T=d-o,E=r-s,O=Math.sqrt(T*T+E*E);if(O<1)return!1;for(var a=0;a<x.length;a++){var y=x[a];if(y.active){var e=y.body;if(e){var G=e.x+e.width*.5,i=e.y+e.height*.5,w=G-o,l=i-s,c=Math.sqrt(w*w+l*l);if(!(c<34)&&!(c>O-10)){var n=new Phaser.Geom.Rectangle(e.x,e.y,e.width,e.height);if(Phaser.Geom.Intersects.LineToRectangle(m,n))return!0}}}}return!1}function z(t,o,s,d,r){if(!t.obstacles)return null;for(var m=new Phaser.Geom.Line(o,s,d,r),x=t.obstacles.getChildren(),T=null,E=1e9,O=0;O<x.length;O++){var a=x[O];if(!(!a.active||!a.body)){var y=a.body,e=new Phaser.Geom.Rectangle(y.x,y.y,y.width,y.height);if(Phaser.Geom.Intersects.LineToRectangle(m,e)){var G=y.x+y.width*.5,i=y.y+y.height*.5,w=Phaser.Math.Distance.Between(o,s,G,i);w<E&&(E=w,T=a)}}}return T}function J(t,o,s,d){var r=t.make.graphics({x:0,y:0,add:!1});r.clear(),r.fillStyle(d,1),r.fillTriangle(s/2,1,1,s-1,s-1,s-1),r.generateTexture(o,s,s),r.destroy()}function ge(t,o,s,d){var r=t.make.graphics({x:0,y:0,add:!1});r.clear(),r.fillStyle(0,.35),r.fillCircle(s/2+1,s/2+1,s/2),r.fillStyle(d,1),r.fillCircle(s/2,s/2,s/2-1),r.generateTexture(o,s,s),r.destroy()}function he(t,o,s,d,r){var m=t.make.graphics({x:0,y:0,add:!1});m.clear(),m.fillStyle(r,1),m.fillRoundedRect(0,0,s,d,10),m.lineStyle(2,16777215,.12),m.strokeRoundedRect(2,2,s-4,d-4,8),m.lineStyle(1,65484,.1),m.beginPath(),m.moveTo(8,d*.35),m.lineTo(s-8,d*.35),m.moveTo(8,d*.65),m.lineTo(s-8,d*.65),m.strokePath(),m.generateTexture(o,s,d),m.destroy()}function Te(t,o,s){var d=t.make.graphics({x:0,y:0,add:!1});d.clear(),d.fillStyle(724758,1),d.fillCircle(s/2,s/2,s/2),d.lineStyle(2,65484,.55),d.strokeCircle(s/2,s/2,s/2-2),d.fillStyle(65484,.18),d.fillCircle(s/2,s/2,s/2-4),d.generateTexture(o,s,s),d.destroy()}function be(t){if(D){try{D.destroy(!0)}catch{}D=null}var o=430,s=820,d={type:Phaser.AUTO,parent:"game",width:o,height:s,backgroundColor:"#05070b",physics:{default:"arcade",arcade:{debug:!1,gravity:{y:0}}},scene:{preload:m,create:x,update:O}};const r={cfg:t,hp:t.frame.hp,hpMax:t.frame.hp,en:t.frame.en,enMax:t.frame.en,enRegen:t.frame.enRegen,speed:t.frame.speed,score:0,t0:0,lastA:0,lastB:0,target:null,lastSwitch:0,targetDist:0,lastDelta:0,dead:!1};function m(){J(this,"p",30,65484),J(this,"e",26,16731469),ge(this,"ba",10,65484),ge(this,"bb",10,16732120),Te(this,"mn",22),he(this,"obA",140,90,2765892),he(this,"obB",220,130,2305082),he(this,"obC",110,180,2568772)}function x(){S("scene.create");var a=this;a.rangeTexts||(a.rangeTexts=[]),a.lockG||(a.lockG=a.add.graphics().setDepth(4)),a.radarG||(a.radarG=a.add.graphics().setScrollFactor(0).setDepth(10),a.radarX=320,a.radarY=120,a.radarR=58,a.radarRange=900),r.t0=a.time.now,a.physics.world.setBounds(-4e3,-4e3,8e3,8e3),a.player=a.physics.add.image(0,0,"p"),a.player.setDepth(2),a.player.setCircle(10),a.enemies=a.physics.add.group(),a.spawnAcc=0,a.spawnInterval=.85;function y(){var h=Math.random()*Math.PI*2,u=520+Math.random()*520,A=a.player.x+Math.cos(h)*u,B=a.player.y+Math.sin(h)*u,R=a.enemies.create(A,B,"e");return R.setData("hp",18),R.setData("blocked",!1),R.setRotation(Phaser.Math.Angle.Between(A,B,a.player.x,a.player.y)+Math.PI/2),R.setCollideWorldBounds(!1),R.setDepth(1),R}for(var e=0;e<6;e++)y();S("spawn init enemies="+a.enemies.getChildren().length),a.obsSpawnAcc=0,a.obsSpawnInterval=2.2,a.bullets=a.physics.add.group(),a.mines=a.physics.add.group(),a.obstacles=a.physics.add.staticGroup();for(var G=["obA","obB","obC"],i=0;i<25;i++){var w=Math.random()*Math.PI*2,l=280+Math.random()*1400,c=a.player.x+Math.cos(w)*l,n=a.player.y+Math.sin(w)*l,f=G[Math.random()*G.length|0],p=a.obstacles.create(c,n,f),b=p.body&&p.body.width?p.body.width:p.displayWidth||60,P=p.body&&p.body.height?p.body.height:p.displayHeight||60,k=Math.max(30,Math.floor(b*P/10));p.setData("maxHp",k),p.setData("hp",k),p.setAlpha(.55),p.setAlpha(.85),p.setRotation((Math.random()*2-1)*.18),p.setDepth(0),p.refreshBody()}a.obAcc=0,a.topPanelG=a.add.graphics().setScrollFactor(0).setDepth(11),a.bottomPanelG=a.add.graphics().setScrollFactor(0).setDepth(11),a.mechInfoText=a.add.text(0,0,"",{fontFamily:"system-ui, sans-serif",fontSize:"16px",fontStyle:"700",fill:"#e8eefc",stroke:"#000",strokeThickness:5}).setScrollFactor(0).setDepth(12).setOrigin(0,1),a.barG=a.add.graphics().setScrollFactor(0).setDepth(10),a.rangeG=a.add.graphics().setDepth(0),a.lockG=a.add.graphics().setDepth(4),a.rangeTexts=[],a.radarG=a.add.graphics().setScrollFactor(0).setDepth(10),a.radarX=320,a.radarY=120,a.radarR=58,a.radarRange=900,a.cameras.main.startFollow(a.player,!0,.12,.12);var Y=Math.max(r.cfg.wpnA.range||0,r.cfg.wpnB.range||0,520),K=q(680/Y,.45,.9);a.cameras.main.setZoom(K),a.physics.add.overlap(a.bullets,a.enemies,function(h,u){if(!(!h.active||!u.active)){te(a,h.x,h.y,h.getData("pierce")?1:0);var A=h.getData("dmg")||6,B=u.getData("hp")||20;B-=A,u.setData("hp",B),h.destroy(),B<=0&&(u.destroy(),r.score+=1,r.kills=(r.kills||0)+1,U("kill",r.battleTimeMs||0,"KILL ("+(h.getData("weaponName")||"WEAPON")+")"))}}),a.physics.add.overlap(a.bullets,a.obstacles,function(h,u){if(!(!h.active||!u.active)){var A=h.getData("bornAt")||0;if(!(A&&a.time.now-A<60)){var B=h.getData("aoe")||0,R=h.getData("dmg")||10;if(B>0&&h.getData("explodeOnObstacle")){te(a,h.x,h.y,2);var V=a.add.circle(h.x,h.y,B,16732120,.14);V.setBlendMode(Phaser.BlendModes.ADD),a.time.delayedCall(180,function(){V.active&&V.destroy()})}else te(a,h.x,h.y,1);var $=u.getData("hp"),N=u.getData("maxHp")||60;typeof $!="number"&&($=N),$-=R,u.setData("hp",$);var L=Math.max(0,$/N);if(u.setAlpha(.25+L*.45),u.setTint){var W=L<.5?9082293:7306918;L<.25&&(W=9132634),u.setTint(W)}$<=0&&(te(a,u.x,u.y,2),u.destroy(),U("obj",r.battleTimeMs||0,"OBJECT DESTROYED")),h.destroy()}}}),a.physics.add.collider(a.player,a.obstacles),a.physics.add.collider(a.enemies,a.obstacles),a.input.on("pointerdown",function(h){if(!r.dead){var u=Phaser.Math.Angle.Between(a.player.x,a.player.y,h.worldX,h.worldY);a.player.rotation=u+Math.PI/2,a.physics.velocityFromRotation(u,r.speed,a.player.body.velocity)}}),a.spawnAcc=0,a.dmgAcc=0,X("BATTLE STARTED"),S("Battle started")}function T(a){for(var y=a.enemies.getChildren(),e=0;e<2;e++){for(var G=null,i=1e18,w=0;w<y.length;w++){var l=y[w];if(l.active){var c=j(a,a.player.x,a.player.y,l.x,l.y);if(!(e===0&&c)){var n=l.x-a.player.x,f=l.y-a.player.y,p=n*n+f*f;p<i&&(i=p,G=l)}}}if(G)return G}return null}function E(a,y,e,G){if(!r.dead&&!(!r.target||!r.target.active)){var i=y,w=r.target,l=a.player.x,c=a.player.y,n=w.x,f=w.y,p=Phaser.Math.Distance.Between(l,c,n,f);if(!(i.range>0&&p>i.range)){if(i.type!=="melee"&&i.type!=="mine"){var b=j(a,l,c,n,f);if(b){var P=z(a,l,c,n,f);if(P&&P.active)n=P.x,f=P.y,P.body&&(n=P.body.x+P.body.width*.5,f=P.body.y+P.body.height*.5),a._breakCoverAcc=(a._breakCoverAcc||0)+(r.lastDelta||0),a._breakCoverAcc>1200&&(a._breakCoverAcc=0,U("obj",r.battleTimeMs||0,"BREAK COVER → obstacle"));else return}}if(i.type==="melee"){var k=Math.PI*.65,Y=Phaser.Math.Angle.Between(l,c,n,f);a.player.rotation=Y+Math.PI/2,a.slashG||(a.slashG=a.add.graphics(),a.slashG.setDepth(2)),a.slashG.clear(),a.slashG.fillStyle(65484,.1),a.slashG.lineStyle(2,65484,.28),a.slashG.beginPath(),a.slashG.slice(l,c,i.range,Y-k/2,Y+k/2,!1),a.slashG.closePath(),a.slashG.fillPath(),a.slashG.strokePath(),a.time.delayedCall(90,function(){a.slashG&&a.slashG.clear()});for(var K=a.enemies.getChildren(),h=Math.max(10,Math.floor(i.dps*i.cd)),u=0;u<K.length;u++){var A=K[u];if(A.active){var B=A.x-l,R=A.y-c,V=Math.sqrt(B*B+R*R);if(!(V>i.range)){var $=Math.atan2(R,B),N=Phaser.Math.Angle.Wrap($-Y);Math.abs(N)<=k/2&&(A.setData("hp",(A.getData("hp")||20)-h),A.getData("hp")<=0&&(A.destroy(),r.score+=1))}}}return}if(i.type==="mine"){var L=a.physics.add.image(l,c,"mn");L.setDepth(1),L.setCircle(10),L.body.setImmovable(!0),L.body.setVelocity(0,0),L.setAlpha(.55),L.setData("armed",!1),L.setData("armAt",e+(i.armMs||240)),L.setData("radius",i.radius||120),L.setData("dmg",Math.max(12,Math.floor(i.dps*.9))),a.mines.add(L);return}var W=Phaser.Math.Angle.Between(l,c,n,f);a.player.rotation=W+Math.PI/2;var ye=Math.cos(W)*26,fe=Math.sin(W)*26,M=a.physics.add.image(l+ye,c+fe,G);M.setDepth(3),M.setCircle(4),M.setData("dmg",Math.max(6,Math.floor(i.dps*i.cd))),M.setData("bornAt",e),M.setData("pierce",!!i.pierce),M.setData("explodeOnObstacle",!!i.explodeOnObstacle),a.bullets.add(M),a.physics.velocityFromRotation(W,i.speed||1e3,M.body.velocity);var xe=Math.floor((i.range||900)/(i.speed||1e3)*1e3)+1200;a.time.delayedCall(xe,function(){M.active&&M.destroy()}),(i.type==="lob"||i.type==="missile")&&(M.setData("aoe",i.radius||90),M.setData("explodeOnObstacle",!!i.explodeOnObstacle))}}}function O(a,y){var e=this,G=r.startMs!=null?(e.time.now-r.startMs)/1e3:0;r.lastDelta=y;try{if(e._dbgAcc=(e._dbgAcc||0)+y,e._dbgAcc>700&&(e._dbgAcc=0,S("tick "+Math.floor(a))),r.dead)return;if(r.en=q(r.en+r.enRegen*(y/1e3),0,r.enMax),e.spawnAcc+=y/1e3,e.spawnAcc>=e.spawnInterval&&(e.spawnAcc=0,e.enemies.getChildren().length<26)){var i=Math.random()*Math.PI*2,w=560+Math.random()*660,l=e.player.x+Math.cos(i)*w,c=e.player.y+Math.sin(i)*w,n=e.enemies.create(l,c,"e");n.setData("hp",18),n.setData("blocked",!1),n.setRotation(Phaser.Math.Angle.Between(l,c,e.player.x,e.player.y)+Math.PI/2),n.setDepth(1)}e._cntAcc=(e._cntAcc||0)+y,e._cntAcc>2500&&(e._cntAcc=0,S("counts enemies="+e.enemies.getChildren().length+" obstacles="+(e.obstacles?e.obstacles.getChildren().length:0)+" bullets="+e.bullets.getChildren().length));for(var H=e.enemies&&e.enemies.getChildren?e.enemies.getChildren():[],f=0;f<H.length;f++){var n=H[f];if(!(!n.active||!n.body)){var p=Phaser.Math.Angle.Between(n.x,n.y,e.player.x,e.player.y),b=n.body.velocity.x,P=n.body.velocity.y,k=b*b+P*P,Y=n.body.blocked&&(n.body.blocked.left||n.body.blocked.right||n.body.blocked.up||n.body.blocked.down)||n.body.touching&&(n.body.touching.left||n.body.touching.right||n.body.touching.up||n.body.touching.down)||k<40,K=n.getData("turnBias")||0,h=n.getData("turnBiasT")||0;(Y||h<=0)&&(K=(Math.random()<.5?-1:1)*(.35+Math.random()*.35),h=220+Math.random()*260),h-=y,n.setData("turnBias",K),n.setData("turnBiasT",h);var u=p+(h>0?K:0),A=74,B=Phaser.Math.Distance.Between(n.x,n.y,e.player.x,e.player.y),R=A+(B<260?26:0);n.body.setVelocity(Math.cos(u)*R,Math.sin(u)*R),n.rotation=u+Math.PI/2}}var Ae=e.mines&&e.mines.getChildren?e.mines.getChildren():[],V=e.obstacles&&e.obstacles.getChildren?e.obstacles.getChildren():[];if(e.obsSpawnAcc+=y/1e3,e.obsSpawnAcc>=e.obsSpawnInterval){e.obsSpawnAcc=0;var $=e.obstacles&&e.obstacles.getChildren?e.obstacles.getChildren():[];if($.length<70){for(var N=0,L=0;L<$.length;L++){var W=$[L];W.active&&Phaser.Math.Distance.Between(W.x,W.y,e.player.x,e.player.y)<520&&N++}if(N<12){var i=Math.random()*Math.PI*2,w=360+Math.random()*560,l=e.player.x+Math.cos(i)*w,c=e.player.y+Math.sin(i)*w,ye=70+Math.random()*160,fe=50+Math.random()*150,M=e.obstacles.create(l,c,"ob");M.setImmovable(!0),M.body&&typeof M.body.setAllowGravity=="function"&&M.body.setAllowGravity(!1),M.body&&typeof M.body.setSize=="function"&&M.body.setSize(ye,fe,!0),M.displayWidth=ye,M.displayHeight=fe;var xe=Math.max(30,Math.floor(ye*fe/10));M.setData("maxHp",xe),M.setData("hp",xe),M.setAlpha(.55),typeof M.refreshBody=="function"&&M.refreshBody()}}}var g=r.target;if(g&&!g.active&&(g=null),!g)g=T(e),g&&(r.target=g,r.lastSwitch=a);else if(a-r.lastSwitch>=1e3){var re=T(e);if(re&&re!==g){var Je=Phaser.Math.Distance.Between(e.player.x,e.player.y,g.x,g.y),Qe=Phaser.Math.Distance.Between(e.player.x,e.player.y,re.x,re.y);Qe+40<Je&&(g=re,r.target=re,r.lastSwitch=a)}}r.targetDist=g&&g.active?Math.floor(Phaser.Math.Distance.Between(e.player.x,e.player.y,g.x,g.y)):0;for(var Pe=0;Pe<H.length;Pe++){var ve=H[Pe];if(ve.active){var ne=j(e,e.player.x,e.player.y,ve.x,ve.y);ve.setAlpha(ne?.18:1),ve.setData("blocked",ne)}}if(e.lockG.clear(),g&&g.active){e.lockG.lineStyle(2,16722731,.55),e.lockG.beginPath(),e.lockG.moveTo(e.player.x,e.player.y),e.lockG.lineTo(g.x,g.y),e.lockG.strokePath(),e.lockG.fillStyle(16722731,.9);var Me=7;e.lockG.beginPath(),e.lockG.moveTo(g.x,g.y-Me),e.lockG.lineTo(g.x+Me,g.y),e.lockG.lineTo(g.x,g.y+Me),e.lockG.lineTo(g.x-Me,g.y),e.lockG.closePath(),e.lockG.fillPath()}for(var H=e.enemies.getChildren(),ke=0;ke<H.length;ke++){var n=H[ke];if(n.active){var Ne=Phaser.Math.Angle.Between(n.x,n.y,e.player.x,e.player.y),Ze=n.getData("spd")||180;e.physics.velocityFromRotation(Ne,Ze,n.body.velocity),n.rotation=Ne+Math.PI/2;var B=Phaser.Math.Distance.Between(n.x,n.y,e.player.x,e.player.y);B<22&&(r.hp-=.2*(y/16.666))}}for(var Ae=e.mines.getChildren(),Be=0;Be<Ae.length;Be++){var F=Ae[Be];if(F.active&&(!F.getData("armed")&&a>=(F.getData("armAt")||0)&&(F.setData("armed",!0),F.setAlpha(.95)),F.getData("armed")))for(var Re=F.getData("radius")||120,We=Re*Re,f=0;f<H.length;f++){var Ce=H[f];if(Ce.active){var le=Ce.x-F.x,se=Ce.y-F.y;if(le*le+se*se<=We){for(var ze=F.getData("dmg")||18,Ie=0;Ie<H.length;Ie++){var ee=H[Ie];if(ee.active){var Ue=ee.x-F.x,qe=ee.y-F.y;Ue*Ue+qe*qe<=We&&(ee.setData("hp",(ee.getData("hp")||20)-ze),ee.getData("hp")<=0&&(ee.destroy(),r.score+=1))}}var Le=e.add.circle(F.x,F.y,Re,65484,.18);Le.setBlendMode(Phaser.BlendModes.ADD),e.time.delayedCall(180,function(){Le.active&&Le.destroy()}),F.destroy();break}}}}if(g&&g.active){var Ee=r.cfg.ai,$e=Ee.prefer,ea=Phaser.Math.Distance.Between(e.player.x,e.player.y,g.x,g.y),we=360;$e==="near"&&(we=220),$e==="mid"&&(we=380),$e==="far"&&(we=520);var aa=r.hp/r.hpMax<Ee.fleeHp,Fe=Phaser.Math.Angle.Between(e.player.x,e.player.y,g.x,g.y),ue=1;aa||ea<we*Ee.keep?ue=-1:ue=1,e.physics.velocityFromRotation(Fe,r.speed*.85*ue,e.player.body.velocity),e.player.rotation=ue===1?Fe+Math.PI/2:Fe-Math.PI/2}var oe=r.cfg.wpnA,ie=r.cfg.wpnB;a-r.lastA>=oe.cd*1e3&&(r.lastA=a,E(e,oe,a,"ba")),a-r.lastB>=ie.cd*1e3&&(r.lastB=a,E(e,ie,a,"bb")),e.rangeG.clear();for(var ta=Math.max(oe.range||0,ie.range||0,0),Ye=200,Ke=Math.max(1,Math.floor(ta/Ye));e.rangeTexts.length<Ke;){var Xe=e.add.text(0,0,"",{fontFamily:"system-ui, sans-serif",fontSize:"13px",fill:"#e8eefc",stroke:"#000",strokeThickness:3});Xe.setDepth(9),e.rangeTexts.push(Xe)}for(var Oe=0;Oe<e.rangeTexts.length;Oe++)e.rangeTexts[Oe].setVisible(!1);for(var Se=1;Se<=Ke;Se++){var De=Se*Ye;e.rangeG.lineStyle(1,16777215,.08),e.rangeG.strokeCircle(e.player.x,e.player.y,De);var i=-Math.PI/4,ra=e.player.x+Math.cos(i)*De,na=e.player.y+Math.sin(i)*De,He=e.rangeTexts[Se-1];He.setText(String(De)),He.setPosition(ra+6,na-10),He.setVisible(!0)}if(oe.range&&oe.range>0&&(e.rangeG.lineStyle(2,65484,.2),e.rangeG.strokeCircle(e.player.x,e.player.y,oe.range)),ie.range&&ie.range>0&&(e.rangeG.lineStyle(2,16732120,.18),e.rangeG.strokeCircle(e.player.x,e.player.y,ie.range)),e.radarG){e.radarG.clear();var ce=e.radarX,de=e.radarY,pe=e.radarR;e.radarG.fillStyle(0,.35),e.radarG.fillCircle(ce,de,pe+8),e.radarG.lineStyle(2,65484,.22),e.radarG.strokeCircle(ce,de,pe),e.radarG.lineStyle(1,16777215,.08),e.radarG.strokeCircle(ce,de,pe*.66),e.radarG.strokeCircle(ce,de,pe*.33),e.radarG.fillStyle(65484,.9),e.radarG.fillCircle(ce,de,3);for(var _e=e.radarRange,Ve=0;Ve<H.length;Ve++){var n=H[Ve];if(n.active){var le=n.x-e.player.x,se=n.y-e.player.y,w=Math.sqrt(le*le+se*se);if(!(w>_e)){var la=ce+le/_e*pe,sa=de+se/_e*pe,ne=!!n.getData("blocked");e.radarG.fillStyle(ne?16732120:16722731,ne?.7:.85),e.radarG.fillCircle(la,sa,ne?2:2.5)}}}}e.scorePanelG=e.add.graphics().setScrollFactor(0).setDepth(11),e.scoreLabelText=e.add.text(0,0,"SCORE",{fontFamily:"system-ui, sans-serif",fontSize:"12px",fontStyle:"700",fill:"#b8c6ff",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(12),e.scoreValueText=e.add.text(0,0,"0",{fontFamily:"system-ui, sans-serif",fontSize:"22px",fontStyle:"700",fill:"#e8eefc",stroke:"#000",strokeThickness:4}).setScrollFactor(0).setDepth(12),e.waveTimeText=e.add.text(0,0,"W1  00:00",{fontFamily:"system-ui, sans-serif",fontSize:"14px",fontStyle:"700",fill:"#e8eefc",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(12),e.hpText=e.add.text(0,0,"HP 0/0",{fontFamily:"system-ui, sans-serif",fontSize:"18px",fontStyle:"700",fill:"#e8eefc",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(12),e.expText=e.add.text(0,0,"EXP 0",{fontFamily:"system-ui, sans-serif",fontSize:"14px",fontStyle:"700",fill:"#ffd36b",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(12),e.hpBarG=e.add.graphics().setScrollFactor(0).setDepth(11),e.expBarG=e.add.graphics().setScrollFactor(0).setDepth(11),e.hpGroup=e.add.container(0,0,[e.hpText,e.expText,e.hpBarG,e.expBarG]).setScrollFactor(0).setDepth(12),e.weaponMainText=e.add.text(0,0,"MAIN",{fontFamily:"system-ui, sans-serif",fontSize:"13px",fill:"#e8eefc",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(12),e.weaponSubText=e.add.text(0,0,"SUB",{fontFamily:"system-ui, sans-serif",fontSize:"13px",fill:"#e8eefc",stroke:"#000",strokeThickness:3}).setScrollFactor(0).setDepth(12),e.weaponG=e.add.graphics().setScrollFactor(0).setDepth(12),e.weaponGroup=e.add.container(0,0,[e.weaponG,e.weaponMainText,e.weaponSubText]).setScrollFactor(0).setDepth(12),Z(e,r,G),r.hp<=0&&(r.dead=!0,r.hp=0,me(r.score,Math.floor(G||0),r.cfg))}catch(ae){S("EXCEPTION: "+(ae&&ae.message?ae.message:ae)+(ae&&ae.stack?`
`+ae.stack:"")),r.dead=!0}}D=new Phaser.Game(d)}function me(t,o,s){try{D&&D.scene.pause()}catch{}I.showResult(t,o,s)}return S("bootGame called"),be(v),{destroy:()=>{try{D&&(D.destroy(!0),D=null)}catch{}}}},C=v=>{const I=document.getElementById(v);if(!I)throw new Error(`Missing required element: ${v}`);return I},da=v=>{let D=Math.max(0,v|0);const S=Math.floor(D/36e5);D-=S*36e5;const X=Math.floor(D/6e4);D-=X*6e4;const U=Math.floor(D/1e3),q=D-U*1e3;return`${String(S).padStart(2,"0")}:${String(X).padStart(2,"0")}:${String(U).padStart(2,"0")}.${String(q).padStart(3,"0")}`},pa=v=>v.replace(/[&<>"]/g,I=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[I]??I),ha=v=>{const I=C("debugBtn"),D=C("debugPanel"),S=C("mechLogPanel"),X=C("mechLogLines"),U=C("startPanel"),q=C("resultPanel"),te=C("toast"),Z=C("selFrame"),j=C("selWpnA"),z=C("selWpnB"),J=C("selAI"),ge=C("frameDesc"),he=C("wpnADesc"),Te=C("wpnBDesc"),be=C("aiDesc"),me=C("kpi"),t=C("resultText"),o=C("resultKpi"),s=C("btnStart"),d=C("btnRetry");let r=!1;const m=[],x=[],T=window.location.hostname==="localhost"||window.location.search.includes("debug=1");document.body.classList.toggle("is-debug",T),I.style.display=T?"block":"none";const E=()=>{const c=x.map((n,f)=>{const p=f===x.length-1?"is-latest":"is-old";return`<div class='line ${n.cls} ${p}'>${da(n.t)} ${pa(n.msg)}</div>`});for(;c.length<5;)c.push("<div class='line placeholder'>&nbsp;</div>");X.innerHTML=c.join("")};S.style.display="none",E();const O=l=>{const c=new Date().toISOString().slice(11,19);m.push(`[${c}] ${l}`),m.length>200&&m.shift(),D.textContent=m.join(`
`)},a=l=>{te.textContent=String(l)},y=(l,c,n)=>{S.style.display="block";const f=`c-${l??"sys"}`;x.push({t:c|0,cls:f,msg:n}),x.length>5&&x.shift(),E(),S.style.opacity="0",requestAnimationFrame(()=>{S.style.opacity="0.8"}),window.clearTimeout(S.__fadeTimer),S.__fadeTimer=window.setTimeout(()=>{S.style.opacity="0.35"},2500)},e=(l,c)=>{l.innerHTML="",c.forEach(n=>{const f=document.createElement("option");f.value=n.id,f.textContent=n.name??n.id,l.appendChild(f)})},G=()=>{const l=v.frames.find(b=>b.id===Z.value),c=v.weapons.find(b=>b.id===j.value),n=v.weapons.find(b=>b.id===z.value),f=v.ai.find(b=>b.id===J.value);if(!l||!c||!n||!f)return;ge.textContent=`${l.desc}  (HP ${l.hp} / SPD ${l.speed})`,he.textContent=`${c.desc}  (R ${c.range} / DPS ${c.dps})`,Te.textContent=`${n.desc}  (R ${n.range} / DPS ${n.dps})`,be.textContent=f.desc,me.innerHTML="";const p=(b,P)=>{const k=document.createElement("div");k.className=`pill ${P??""}`.trim(),k.textContent=b,me.appendChild(k)};p(`FRAME: ${l.name}`,"good"),p(`MAIN: ${c.name}`),p(`SUB: ${n.name}`),p(`AI: ${f.name}`)};return e(Z,v.frames),e(j,v.weapons),e(z,v.weapons),e(J,v.ai),Z.value="middle",j.value="mg",z.value="cannon",J.value="balanced",Z.addEventListener("change",G),j.addEventListener("change",G),z.addEventListener("change",G),J.addEventListener("change",G),G(),U.classList.remove("hidden"),q.classList.add("hidden"),S.style.display="none",T&&I.addEventListener("click",()=>{r=!r,D.style.display=r?"block":"none"}),window.addEventListener("error",l=>{var n;const c=l!=null&&l.message?l.message:String(l);O(`ERROR: ${c}${(n=l==null?void 0:l.error)!=null&&n.stack?`
${l.error.stack}`:""}`),a(`ERROR: ${c}`)}),{onStart:l=>s.addEventListener("click",l),onRetry:l=>d.addEventListener("click",l),hideStart:()=>{U.classList.add("hidden"),S.style.display="block"},showStart:()=>{U.classList.remove("hidden"),S.style.display="none"},hideResult:()=>q.classList.add("hidden"),showResultPanel:()=>{q.classList.remove("hidden"),S.style.display="none"},getConfig:()=>({frameId:Z.value,wpnAId:j.value,wpnBId:z.value,aiId:J.value}),setToast:a,setDebug:O,pushMechLog:y,renderResult:(l,c,n)=>{const f=`SCORE: ${l}
TIME: ${c}s
FRAME: ${n.frame.name} / AI: ${n.ai.name}
MAIN: ${n.wpnA.name} / SUB: ${n.wpnB.name}`;t.textContent=f,o.innerHTML="";const p=(b,P)=>{const k=document.createElement("div");k.className=`pill ${P??""}`.trim(),k.textContent=b,o.appendChild(k)};p(`SCORE ${l}`,"good"),p(`TIME ${c}s`),p(n.frame.name),p(n.ai.name),p(`MAIN ${n.wpnA.name}`),p(`SUB ${n.wpnB.name}`,"bad")}}},_=ha(Ge),ya=v=>{const I=oa[v.frameId],D=je[v.wpnAId],S=je[v.wpnBId],X=ia[v.aiId];if(!I||!D||!S||!X)throw new Error("Invalid loadout selection.");return{frame:I,wpnA:D,wpnB:S,ai:X}};let Q=null;const fa={toast:_.setToast,debug:_.setDebug,mechLog:_.pushMechLog,showResult:(v,I,D)=>{_.renderResult(v,I,D),_.showResultPanel()}};_.onStart(()=>{_.hideResult(),_.hideStart();const v=ya(_.getConfig());Q==null||Q.destroy(),Q=ca(v,fa)});_.onRetry(()=>{_.hideResult(),_.showStart(),Q==null||Q.destroy(),Q=null,_.setToast("READY")});
